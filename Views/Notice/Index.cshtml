@using NoticeBoardApp.Models
@model IEnumerable<Notice>

@{
    ViewData["Title"] = "Notice Board";
    Layout = "~/Views/Shared/_Layout.cshtml";
}


<div class="d-flex justify-content-between mt-5">    
    <h1 class="h4 fw-bold"> All Notice </h1>
    <a class="btn btn-primary" asp-controller="Notice" asp-action="Create"> Create New </a>
</div>

<hr class="mt-1 mb-3" />

<div id="notice-board" class="row px-2">

    @foreach (var notice in Model)
    {        
        <div class="card mt-4 notice-container">
            <span class="position-absolute top-0 ms-2 translate-middle badge rounded-pill bg-danger">views @notice.TotalViews </span>
        
            <div class="card-body">
                <h5 class="card-title fw-bold">
                    @notice.Title
                </h5>
                
                @if (!string.IsNullOrEmpty(notice.SubTitle))
                {
                    <h6 class="card-subtitle fst-italic mt-1">
                        @notice.SubTitle
                    </h6>                    
                }

                <p class="card-text mt-3">
                    @notice.Details.Substring(0, 200)...
                </p>

                <div class="mt-3">
                    <a class="btn btn-sm btn-primary" asp-controller="Notice" asp-action="Details" asp-route-id="@notice.Id"> View </a>
                    <a class="btn btn-sm btn-dark" asp-controller="Notice" asp-action="Edit" asp-route-id="@notice.Id"> Edit </a>
                    <button class="btn btn-sm btn-danger delete-notice" data-id="@notice.Id"> Delete </button>                        
                    
                    @*@if (!notice.IsDeleted)
                    {
                        <button class="btn btn-sm btn-danger delete-notice" data-id="@notice.Id"> Delete </button>                        
                    }
                    else{
                        <button class="btn btn-sm btn-outline-secondary disabled" > Already Deleted </button>                        
                    }*@
                </div>

            </div>
        </div>
    }

</div>


@section Scripts{

    <partial name="_ValidationScriptsPartial" />

    <script>

        $("#notice-board .delete-notice").on("click", function() {
            let container = $(this).parents(".notice-container");
            let id = $(this).data("id");


            bootbox.confirm({
                closeButton: false,
                message: "Are you sure you want to delete this notice?",
                buttons: {
                    confirm: {
                        label: 'Yes',
                        className: 'btn-danger'
                    },
                    cancel: {
                        label: 'No',
                        className: 'btn-primary'
                    }
                },
                callback: function (result) {

                    if (result) {
                        $.ajax({
                            url: "/Notice/Delete/" + id,
                            success: function(response) {
                                container.fadeOut();
                            },
                            error: function(error) {
                                console.log(error.statusText);
                            }
                        })
                    }

                }
            });

        })

    </script>

}
